name: Auto-generate ZIP on changes
on:
  push:
    branches: [ main, master ]
    paths:
      - 'FUENTES/**'
  workflow_dispatch:

permissions:
  contents: write
  actions: read

jobs:
  create-zip:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      # ‚Üê Removido fetch-depth y token problem√°ticos
    
    - name: Debug current state
      run: |
        echo "üìÅ Contenido REAL de FUENTES:"
        ls -la FUENTES/
        echo "üîç Verificando dummy2.txt:"
        if [ -f "FUENTES/dummy2.txt" ]; then
          echo "‚ùå dummy2.txt EXISTE (problema!)"
        else
          echo "‚úÖ dummy2.txt NO existe (correcto)"
        fi
        
    - name: Create ZIP file
      run: |
        echo "üì¶ Creando ZIP desde carpeta FUENTES..."
        cd FUENTES
        echo "Archivos que se incluir√°n en el ZIP:"
        ls -la
        zip -r ../FUENTES.zip . -x "*.git*" "*.DS_Store*"
        cd ..
        echo "‚úÖ ZIP creado"
        
    - name: Show ZIP contents
      run: |
        echo "üìã Contenido del ZIP creado:"
        unzip -l FUENTES.zip
        
    - name: Commit ZIP
      run: |
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
        git add FUENTES.zip
        git commit -m "ü§ñ Auto-update FUENTES.zip [skip ci]"
        git push
