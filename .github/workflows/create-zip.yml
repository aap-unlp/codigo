name: Auto-generate ZIP on changes
on:
  push:
    branches: [ main, master ]
    paths:
      - 'FUENTES/**'
  workflow_dispatch:

permissions:
  contents: write
  actions: read

jobs:
  create-zip:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
    
    - name: Debug - Show current state
      run: |
        echo "ğŸ” DEBUG INFO:"
        echo "Rama actual: ${{ github.ref_name }}"
        echo "ğŸ“ Contenido de FUENTES:"
        ls -la FUENTES/ || echo "âŒ FUENTES no existe"
        echo "ğŸ“¦ ZIP actual (si existe):"
        ls -la FUENTES.zip || echo "â„¹ï¸ FUENTES.zip no existe aÃºn"
        echo "ğŸ†” Ãšltimo commit:"
        git log -1 --oneline
    
    - name: Create ZIP file
      run: |
        echo "ğŸ“¦ Creando ZIP desde carpeta FUENTES..."
        cd FUENTES
        zip -r ../FUENTES.zip . -x "*.git*" "*.DS_Store*"
        cd ..
        echo "âœ… ZIP creado exitosamente"
        ls -la FUENTES.zip
        echo "ğŸ“Š TamaÃ±o del ZIP:"
        du -h FUENTES.zip
    
    - name: Check git status
      run: |
        echo "ğŸ”„ Estado de Git:"
        git status
        echo "ğŸ“‹ Archivos modificados:"
        git diff --name-only
        echo "ğŸ“‹ Archivos staged:"
        git diff --staged --name-only
    
    - name: Force commit ZIP (for testing)
      run: |
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
        echo "ğŸ¤– Forzando commit del ZIP..."
        git add FUENTES.zip
        
        if git diff --staged --quiet; then
          echo "âš ï¸ No hay cambios para commitear"
        else
          git commit -m "ğŸ¤– Auto-update FUENTES.zip [skip ci]"
          git push origin ${{ github.ref_name }}
          echo "âœ… ZIP actualizado y pusheado"
        fi
